
> hivemind-context-governance@2.6.0 test
> bash scripts/check-sdk-boundary.sh && tsx --test tests/*.test.ts

âœ… Architecture boundary clean: src/lib/ has zero @opencode-ai imports
TAP version 13
# Subtest: generateAgentBehaviorPrompt matrix
    # Subtest: enforces language
    ok 1 - enforces language
      ---
      duration_ms: 1.472009
      type: 'test'
      ...
    # Subtest: enforces expert level
    ok 2 - enforces expert level
      ---
      duration_ms: 0.294321
      type: 'test'
      ...
    # Subtest: enforces output style
    ok 3 - enforces output style
      ---
      duration_ms: 0.320575
      type: 'test'
      ...
    # Subtest: enforces constraints
    ok 4 - enforces constraints
      ---
      duration_ms: 0.26186
      type: 'test'
      ...
    # Subtest: handles edge cases
    ok 5 - handles edge cases
      ---
      duration_ms: 0.264536
      type: 'test'
      ...
    1..5
ok 1 - generateAgentBehaviorPrompt matrix
  ---
  duration_ms: 5.133955
  type: 'test'
  ...
# === Auto-Hooks Pure Function Tests ===
# --- staleness ---
#   PASS: isSessionStale returns false for fresh state
#   PASS: isSessionStale returns true for state older than 3 days
#   PASS: isSessionStale returns false for state exactly at boundary
#   PASS: isSessionStale with custom maxDays=2
#   PASS: isSessionStale with maxDays=0 returns false
#   PASS: getStalenessInfo returns correct idleDays
#   PASS: getStalenessInfo returns correct isStale
#   PASS: getStalenessInfo returns correct threshold
# --- chain-analysis ---
#   PASS: empty hierarchy + OPEN session â†’ 1 break (empty_chain)
#   PASS: empty hierarchy + LOCKED session â†’ 0 breaks
#   PASS: action without tactic â†’ missing_parent break
#   PASS: tactic without trajectory â†’ missing_parent break
#   PASS: action + tactic but no trajectory â†’ 1 break (tactic missing_parent)
#   PASS: full chain â†’ 0 breaks
#   PASS: trajectory only â†’ 0 breaks
#   PASS: tactic + trajectory but no action â†’ 0 breaks
# --- tree-chain-breaks ---
#   PASS: empty gaps â†’ 0 breaks
#   PASS: healthy gap â†’ 0 breaks
#   PASS: stale gap â†’ 1 stale_gap break
#   PASS: break message includes hour count
#   PASS: break message includes relationship
#   PASS: custom 1hr threshold catches warm gap
# --- commit-advisor ---
#   PASS: below threshold â†’ null
#   PASS: at threshold â†’ suggestion
#   PASS: recently suggested (within 3 turns) â†’ null
#   PASS: not recently suggested â†’ suggestion
#   PASS: zero files â†’ null
#   PASS: threshold exactly met â†’ suggestion
# --- tool-activation ---
#   PASS: LOCKED session â†’ declare_intent (high)
#   PASS: high drift â†’ map_context (high)
#   PASS: long session (15+ turns) â†’ compact_session (medium)
#   PASS: no hierarchy + OPEN â†’ map_context (medium)
#   PASS: normal state â†’ null
#   PASS: priority ordering: LOCKED wins over drift + long session
#   PASS: after declaring intent (OPEN, low turns) â†’ null
#   PASS: with hierarchy set, moderate turns â†’ null
#   PASS: completedBranches >= 5 â†’ hierarchy_manage (medium)
#   PASS: hasMissingTree + flat hierarchy â†’ hierarchy_manage (medium)
#   PASS: postCompaction â†’ think_back (medium)
# === Auto-Hooks Pure: 39 passed, 0 failed ===
# Subtest: tests/auto-hooks-pure.test.ts
ok 2 - tests/auto-hooks-pure.test.ts
  ---
  duration_ms: 357.788588
  type: 'test'
  ...
# === CLI Scan Tests ===
# --- cli-scan: default analyze ---
#   PASS: default action is analyze
#   PASS: analyze captures project name
# --- cli-scan: recommend ---
#   PASS: recommend includes header
#   PASS: recommend includes lifecycle sequence
# --- cli-scan: orchestrate requires init ---
#   PASS: orchestrate returns unsuccessful result when uninitialized
#   PASS: orchestrate returns init guard error
# --- cli-scan: orchestrate after init ---
#   PASS: orchestrate action returned
#   PASS: orchestrate persisted anchors
# === CLI Scan: 8 passed, 0 failed ===
# Subtest: tests/cli-scan.test.ts
ok 3 - tests/cli-scan.test.ts
  ---
  duration_ms: 692.691971
  type: 'test'
  ...
# === Compact Purification Tests ===
# --- identifyTurningPoints: finds completed nodes ---
#   PASS: finds 2 completed nodes
#   PASS: finds completed tactic
#   PASS: finds completed action
#   PASS: completed detail has timestamp
# --- identifyTurningPoints: finds cursor path ---
#   PASS: cursor path has 3 nodes (trajectory > tactic > action)
#   PASS: cursor path starts with trajectory
#   PASS: cursor path has tactic
#   PASS: cursor path ends with action
#   PASS: cursor_path items come first in sorted output
# --- identifyTurningPoints: handles empty tree ---
#   PASS: returns empty array for null root
# --- generateNextCompactionReport: produces structured report ---
#   PASS: report has header
#   PASS: report has active work section
#   PASS: report has cursor path section
#   PASS: report has key turning points section
#   PASS: report has files touched section
#   PASS: report has resume instructions
#   PASS: report has footer
#   PASS: report contains session ID
#   PASS: report contains files touched
# --- generateNextCompactionReport: budget-caps at 1800 chars ---
#   PASS: report length 1797 is within 1800 budget
#   PASS: budget-capped report still has footer
# --- compact_session integration: writes next_compaction_report to brain ---
#   PASS: compact result includes purification summary
#   PASS: new state exists after compaction
#   PASS: new state has next_compaction_report set
#   PASS: next_compaction_report has purification header
#   PASS: next_compaction_report has purification footer
# --- compact_session integration: auto-prunes when 5+ completed ---
#   PASS: compact result includes purification summary
#   PASS: state exists after pruned compaction
#   PASS: next_compaction_report exists after auto-prune
# --- compaction hook: injects purification report as first context ---
#   PASS: state exists for hook test setup
#   PASS: compaction hook adds at least 2 context items (purification + standard)
#   PASS: first context item is the purification report
#   PASS: purification report content is preserved
#   PASS: second context item is standard HiveMind context
#   PASS: next_compaction_report is cleared after compaction injection
# === Compact Purification: 35 passed, 0 failed ===
# Subtest: tests/compact-purification.test.ts
ok 4 - tests/compact-purification.test.ts
  ---
  duration_ms: 1046.640463
  type: 'test'
  ...
# === Complexity Tests ===
# --- complexity: below default threshold ---
#   PASS: not complex with 0 files and 0 turns
#   PASS: filesCount is 0
#   PASS: turnsCount is 0
#   PASS: message says normal
# --- complexity: files exceed default threshold ---
#   PASS: complex when 3 files touched (default threshold = 3)
#   PASS: filesCount is 3
#   PASS: message includes files count
# --- complexity: turns exceed default threshold ---
#   PASS: complex when 5 turns (default threshold = 5)
#   PASS: turnsCount is 5
#   PASS: message includes turn count
# --- complexity: both files and turns exceed ---
#   PASS: complex when both exceed
#   PASS: message includes files
#   PASS: message includes turns
# --- complexity: just below default threshold ---
#   PASS: not complex when both below threshold
# --- complexity: custom threshold for files ---
#   PASS: complex when 1 file with maxFiles=1
#   PASS: custom threshold reflected
# --- complexity: custom threshold for turns ---
#   PASS: complex when 2 turns with maxTurns=2
#   PASS: custom threshold reflected
# --- complexity: zero threshold triggers immediately ---
#   PASS: complex with zero thresholds (0 >= 0)
# --- complexity: high threshold never triggers ---
#   PASS: not complex with high thresholds
# --- complexity: normal message format ---
#   PASS: message is exactly 'Complexity normal'
# --- complexity: complex message suggests declare_intent ---
#   PASS: complex message suggests declare_intent
# --- complexity: files-only complex message ---
#   PASS: message mentions files
#   PASS: message does not mention turns when only files exceed
# --- complexity: turns-only complex message ---
#   PASS: message mentions turns
#   PASS: message does not mention files when only turns exceed
# --- complexity: file deduplication ---
#   PASS: deduplicated files count is 2
#   PASS: not complex with 2 unique files (threshold 3)
# === Complexity: 28 passed, 0 failed ===
# Subtest: tests/complexity.test.ts
ok 5 - tests/complexity.test.ts
  ---
  duration_ms: 333.254917
  type: 'test'
  ...
# \# === Cycle Intelligence Tests ===
# --- schema: CycleLogEntry + helpers ---
#   PASS: initial cycle_log is empty array
#   PASS: initial pending_failure_ack is false
#   PASS: addCycleLogEntry clean output â†’ failure_detected = false
#   PASS: addCycleLogEntry clean output â†’ pending_failure_ack stays false
#   PASS: addCycleLogEntry failure output â†’ failure_detected = true
#   PASS: addCycleLogEntry failure output â†’ pending_failure_ack = true
#   PASS: addCycleLogEntry captures specific failure keywords
#   PASS: clearPendingFailureAck sets flag to false
# --- schema: cycle_log cap at MAX_CYCLE_LOG ---
#   PASS: cycle_log capped at 10
#   PASS: oldest entries dropped (FIFO)
#   PASS: newest entry is last
# --- export_cycle: tool tests ---
#   PASS: empty findings returns error
#   PASS: success result includes outcome
#   PASS: tree still has root after export_cycle
#   PASS: export_cycle syncs flat hierarchy projection from tree
#   PASS: mem saved to cycle-intel shelf
#   PASS: mem content includes [SUCCESS] tag
#   PASS: mem has cycle-result tag
#   PASS: failure result includes outcome
#   PASS: failure result includes ack note when pending_failure_ack was set
#   PASS: pending_failure_ack cleared after export_cycle
#   PASS: no session returns error
# --- auto-capture: soft-governance hook ---
#   PASS: non-task tool does not add to cycle_log
#   PASS: task tool adds to cycle_log
#   PASS: cycle_log captures output excerpt
#   PASS: clean task output â†’ no failure detected
#   PASS: second task added to cycle_log
#   PASS: failure keywords in task output â†’ failure_detected = true
#   PASS: failure in task â†’ pending_failure_ack = true
#   PASS: output_excerpt truncated to 500 chars
# --- prompt injection: pending_failure_ack warning ---
#   PASS: no failure warning when pending_failure_ack is false
#   PASS: failure warning shown when pending_failure_ack is true
#   PASS: failure warning mentions export_cycle tool
#   PASS: no failure warning after clearPendingFailureAck
# --- map_context: blocked status clears pending_failure_ack ---
#   PASS: non-blocked map_context does not clear pending_failure_ack
#   PASS: blocked map_context clears pending_failure_ack
#   PASS: blocked map_context when ack already false â†’ no error
# \# === Cycle Intelligence: 37 passed, 0 failed ===
# Subtest: tests/cycle-intelligence.test.ts
ok 6 - tests/cycle-intelligence.test.ts
  ---
  duration_ms: 903.471097
  type: 'test'
  ...
# === Dashboard TUI Tests ===
#   SKIP: ink/react not installed (optional peerDependencies)
# === Dashboard TUI: 0 passed, 0 failed, 9 skipped ===
# Subtest: tests/dashboard-tui.test.ts
ok 7 - tests/dashboard-tui.test.ts
  ---
  duration_ms: 365.185145
  type: 'test'
  ...
# === Detection Engine Tests ===
# --- tool-classification ---
#   PASS: classifyTool('read') â†’ 'read'
#   PASS: classifyTool('write') â†’ 'write'
#   PASS: classifyTool('edit') â†’ 'write'
#   PASS: classifyTool('bash') â†’ 'write'
#   PASS: classifyTool('glob') â†’ 'read'
#   PASS: classifyTool('grep') â†’ 'read'
#   PASS: classifyTool('task') â†’ 'query'
#   PASS: classifyTool('declare_intent') â†’ 'governance'
#   PASS: classifyTool('map_context') â†’ 'governance'
#   PASS: classifyTool('unknown_custom_tool') â†’ 'query' (default)
#   PASS: classifyTool('getData') â†’ 'read' (heuristic: contains 'get')
#   PASS: classifyTool('createFile') â†’ 'write' (heuristic: contains 'create')
# --- counter-logic ---
#   PASS: createDetectionState initializes all zeros
#   PASS: incrementToolType increments correct category
#   PASS: incrementToolType preserves other categories
#   PASS: trackToolResult success resets consecutive_failures
#   PASS: trackToolResult failure increments consecutive_failures
#   PASS: trackSectionUpdate same content increments repetition
#   PASS: trackSectionUpdate different content resets repetition
#   PASS: resetSectionTracking resets counter and content
# --- keyword-scanning ---
#   PASS: scanForKeywords finds 'stuck' in text
#   PASS: scanForKeywords finds 'confused' in text
#   PASS: scanForKeywords finds 'not working' in text
#   PASS: scanForKeywords returns empty for clean text
#   PASS: scanForKeywords skips already-existing flags
#   PASS: addKeywordFlags adds new flags to state
#   PASS: addKeywordFlags deduplicates
#   PASS: addKeywordFlags returns same state if no new flags
# --- signal-compilation ---
#   PASS: compileSignals with 0 turns returns empty
#   PASS: compileSignals with turns >= threshold returns turn_count signal
#   PASS: compileSignals with consecutive_failures >= 3 returns failure signal
#   PASS: compileSignals with section_repetition >= 4 returns circling signal
#   PASS: compileSignals with read_write_imbalance (8 reads, 0 writes) returns signal
#   PASS: compileSignals with keyword_flags returns keyword signal
#   PASS: compileSignals with completedBranches >= 5 returns prune signal
#   PASS: compileSignals with timestampGapMs >= 2h returns gap signal
#   PASS: compileSignals with missingTree returns migration signal
#   PASS: compileSignals sorts by severity (lower number = higher priority)
#   PASS: compileSignals respects maxSignals cap (returns at most N)
#   PASS: formatSignals returns empty string for 0 signals
#   PASS: formatSignals returns [ALERTS] block with correct format
#   PASS: compileSignals with write tools + empty action â†’ tool_hierarchy_mismatch signal
#   PASS: compileSignals with write tools + action set â†’ no mismatch signal
#   PASS: compileSignals with empty action but no writes â†’ no mismatch signal
#   PASS: compileSignals with sessionFileLines >= 50 returns session_file_long signal
# --- governance-primitives ---
#   PASS: createGovernanceCounters initializes defaults
#   PASS: out_of_order starts at info
#   PASS: out_of_order escalates to warning on repeat
#   PASS: out_of_order escalates to error after repeated violations
#   PASS: drift maps warning then error
#   PASS: compaction stays informational
#   PASS: evidence pressure maps warning then error
#   PASS: ignored tier is always error
#   PASS: seriousness score combines intent/hierarchy/role mismatches
#   PASS: single hierarchy mismatch yields medium seriousness
#   PASS: no mismatches yields low seriousness
#   PASS: registerGovernanceSignal increments counters and clears ack
#   PASS: acknowledgment downgrades effective repetition severity
#   PASS: full reset is blocked until prerequisites are complete
#   PASS: full reset clears counters after prerequisite completion
# === Detection Engine: 60 passed, 0 failed ===
# Subtest: tests/detection.test.ts
ok 8 - tests/detection.test.ts
  ---
  duration_ms: 311.770912
  type: 'test'
  ...
# === Ecosystem Check Tests ===
# --- ecosystem-check: valid semantic chain ---
#   PASS: ecosystem-check includes semantic step
#   PASS: semantic step passes for valid hierarchy
#   PASS: healthy stays true for valid hierarchy
#   PASS: trace includes timestamp
#   PASS: trace includes git hash value
# --- ecosystem-check: invalid semantic chain ---
#   PASS: semantic step present even for invalid tree
#   PASS: semantic step fails on invalid hierarchy
#   PASS: healthy is false when semantics fail
# === Ecosystem Check: 8 passed, 0 failed ===
# Subtest: tests/ecosystem-check.test.ts
ok 9 - tests/ecosystem-check.test.ts
  ---
  duration_ms: 751.616758
  type: 'test'
  ...
# === Entry Chain Tests ===
# --- entry-chain: init â†’ verify all files created ---
#   PASS: config.json exists after init
#   PASS: brain.json exists after init
#   PASS: index.md exists after init
#   PASS: active.md exists after init
#   PASS: templates/session.md exists after init
#   PASS: manifest.json exists after init
#   PASS: hierarchy.json does NOT exist yet (created on first declare_intent)
# --- entry-chain: full chain (tests 2-8) ---
#   [Test 2] declare_intent
#   PASS: hierarchy.json now exists after declare_intent
#   PASS: tree has root node with level trajectory
#   PASS: root content matches 'Build auth system'
#   PASS: manifest has active session entry
#   PASS: manifest points to active per-session file
#   PASS: per-session file preserves hierarchy section
#   PASS: per-session file preserves log section
#   PASS: brain governance_status is OPEN
#   PASS: brain hierarchy.trajectory contains 'Build auth system'
#   [Test 3] map_context tactic
#   PASS: tree has 2 nodes (trajectory + tactic)
#   PASS: cursor moved to tactic node (not root)
#   PASS: brain hierarchy.tactic contains 'JWT validation'
#   [Test 4] map_context action
#   PASS: tree has 3 nodes
#   PASS: chain: trajectory > tactic > action
#   PASS: brain hierarchy.action contains 'Write middleware'
#   [Test 5] simulate drift
#   PASS: turn_count >= 6 after simulation
#   PASS: drift_score < 50 after simulation
#   [Test 6] compact_session
#   PASS: at least 1 .md archive file exists
#   PASS: at least 1 .json export file exists
#   PASS: at least 1 .md export file exists
#   PASS: mems have auto-compact entry
#   PASS: brain state is LOCKED after compaction
#   PASS: next_compaction_report is set (non-null)
#   PASS: compaction_count >= 1
#   PASS: last_compaction_time > 0
#   PASS: hierarchy tree is reset (root = null)
#   [Test 7] new declare_intent (cross-session)
#   PASS: new tree created with new root
#   PASS: old archives still exist
#   PASS: mems from previous session can be found (loadMems â†’ mems.length > 0)
#   PASS: new brain.compaction_count carried forward
#   [Test 8] scan_hierarchy
#   PASS: scan_hierarchy output includes session info
#   PASS: scan_hierarchy output includes hierarchy levels
#   PASS: scan_hierarchy output includes metrics
# --- entry-chain: old install â€” no hierarchy.json ---
#   PASS: hierarchy.json does not exist (old install scenario)
#   PASS: map_context does not crash without hierarchy.json
#   PASS: map_context works gracefully (no error in result)
# --- entry-chain: corrupt brain.json recovery ---
#   PASS: declare_intent does not crash with corrupt brain.json
#   PASS: declare_intent creates fresh state after corrupt brain.json
# --- entry-chain: opencode.jsonc handling ---
#   PASS: opencode.jsonc still exists after init
#   PASS: hivemind-context-governance registered in config
#   PASS: existing plugin 'some-other-plugin' preserved in config
#   PASS: provider settings preserved in config
# --- entry-chain: re-init guard ---
#   PASS: first init: governance_mode is strict
#   PASS: first init: language is vi
#   PASS: re-init: governance_mode still strict (not overwritten)
#   PASS: re-init: language still vi (not overwritten)
# --- entry-chain: config persistence ---
#   PASS: loadConfig returns governance_mode=strict from disk
#   PASS: loadConfig returns default max_turns_before_warning=5
#   PASS: deep-merged constraints: be_skeptical defaults to false
#   PASS: deep-merged constraints: enforce_tdd defaults to false
#   PASS: loadConfig reads updated max_turns_before_warning=10 from disk
#   PASS: other config values preserved after partial update
# --- entry-chain: AGENTS.md injection ---
#   PASS: AGENTS.md preserves existing content
#   PASS: AGENTS.md contains HiveMind start marker
#   PASS: AGENTS.md contains HiveMind end marker
#   PASS: AGENTS.md contains core tool names
#   PASS: AGENTS.md contains tool count
# --- entry-chain: AGENTS.md injection is idempotent ---
#   PASS: AGENTS.md has exactly 1 start marker (idempotent)
#   PASS: AGENTS.md section was updated with current content
#   PASS: AGENTS.md old section content was replaced
#   PASS: AGENTS.md content after section is preserved
# --- entry-chain: CLAUDE.md also gets injection ---
#   PASS: CLAUDE.md also receives HiveMind section
#   PASS: CLAUDE.md contains core tool names
# --- entry-chain: no AGENTS.md present â†’ no file created ---
#   PASS: AGENTS.md NOT created when it didn't exist before init
#   PASS: CLAUDE.md NOT created when it didn't exist before init
# === Entry Chain: 72 passed, 0 failed ===
# Subtest: tests/entry-chain.test.ts
ok 10 - tests/entry-chain.test.ts
  ---
  duration_ms: 998.850002
  type: 'test'
  ...
# === Evidence Gate System Tests ===
# --- escalation-tiers ---
#   PASS: at threshold â†’ INFO
#   PASS: below threshold â†’ INFO
#   PASS: 2 over threshold â†’ WARN
#   PASS: 5 over threshold â†’ CRITICAL
#   PASS: 10 over threshold â†’ DEGRADED
#   PASS: 3 over threshold â†’ WARN
#   PASS: 7 over threshold â†’ CRITICAL
#   PASS: zero/zero â†’ INFO
# --- escalated-signals ---
#   PASS: compileEscalatedSignals returns signals with tier
#   PASS: every escalated signal has non-empty evidence
#   PASS: turn_count signal has counter_excuse
#   PASS: evidence includes actual turn count data
#   PASS: counter_excuse contains argument against delay
#   PASS: all signals in multi-signal case have tier + evidence
#   PASS: higher turn count â†’ equal or higher escalation tier
# --- write-without-read ---
#   PASS: write_without_read signal generated when count > 0
#   PASS: write_without_read evidence includes count
#   PASS: no write_without_read signal when count is 0
#   PASS: brain state initializes write_without_read_count to 0
# --- format-escalated ---
#   PASS: formatted output includes [TIER] prefix
#   PASS: formatted output includes EVIDENCE line
#   PASS: formatted output includes counter-excuse with arrow
#   PASS: CRITICAL tier formats correctly
#   PASS: non-escalated signals still use - prefix
# --- automation-level ---
#   PASS: manual is valid automation level
#   PASS: guided is valid automation level
#   PASS: assisted is valid automation level
#   PASS: full is valid automation level
#   PASS: coach is valid automation level
#   PASS: legacy retard alias is accepted
#   PASS: invalid is NOT valid automation level
#   PASS: default automation_level is assisted
#   PASS: config can be created with coach
#   PASS: legacy retard alias is normalized to coach
# --- coach-mode-init ---
#   PASS: init saves coach automation_level to config
#   PASS: coach mode forces strict governance
#   PASS: coach mode forces skeptical output
#   PASS: coach mode forces beginner expert level
#   PASS: coach mode forces code review
#   PASS: coach mode forces be_skeptical
#   PASS: coach mode starts session LOCKED
#   PASS: legacy retard alias is normalized to coach during init
# --- evidence-quality ---
#   PASS: failure evidence includes actual failure count
#   PASS: keyword evidence includes detected keywords
#   PASS: timestamp gap evidence includes hours
#   PASS: missing tree evidence explains consequences
#   PASS: read-write imbalance evidence includes actual read count
# --- ignored-tier-contract ---
#   PASS: 10+ unacknowledged cycles trigger IGNORED tier
#   PASS: IGNORED tier uses error severity
#   PASS: IGNORED evidence block contains sequence evidence
#   PASS: IGNORED evidence block contains plan evidence
#   PASS: IGNORED evidence block contains hierarchy evidence
# --- ignored-reset-policy ---
#   PASS: acknowledgement can downgrade severity
#   PASS: full reset only allowed when prerequisites complete
# === Evidence Gate: 54 passed, 0 failed ===
# Subtest: tests/evidence-gate.test.ts
ok 11 - tests/evidence-gate.test.ts
  ---
  duration_ms: 489.724286
  type: 'test'
  ...
# === Framework Context Tests ===
# --- framework-context: detect none ---
#   PASS: mode is none with no framework markers
#   PASS: no framework flags set
# --- framework-context: detect gsd and phase goal ---
#   PASS: mode is gsd when only .planning exists
#   PASS: active phase parsed from STATE.md
#   PASS: phase goal extracted from roadmap
# --- framework-context: detect spec-kit only ---
#   PASS: mode is spec-kit when only .spec-kit exists
#   PASS: active spec path points to .spec-kit
#   PASS: phase goal is null outside gsd mode
# --- framework-context: detect both frameworks ---
#   PASS: mode is both when both framework markers exist
#   PASS: both framework flags are true
#   PASS: active phase still available in dual mode
# --- framework-context: locked selection menu contract ---
#   PASS: dual framework menu is marked as conflict
#   PASS: menu has exactly four locked options
#   PASS: first option label is Use GSD
#   PASS: second option label is Use Spec-kit
#   PASS: third option label is override
#   PASS: fourth option label is cancel
#   PASS: Use GSD requires active_phase
#   PASS: Use Spec-kit requires active_spec_path
#   PASS: Override requires acceptance_note
#   PASS: Cancel requires no metadata
# --- framework-context: extract goal without planning files ---
#   PASS: returns null when planning files are missing
# --- framework-context: limited mode simulated block with rollback guidance ---
#   PASS: limited mode remains non-blocking (advisory only)
#   PASS: limited mode warning includes framework advisory
#   PASS: limited mode warning includes framework selection guidance
# --- framework-context: simulated pause remains non-blocking ---
#   PASS: simulated pause does not hard-deny tool execution
#   PASS: simulated pause warning includes framework advisory
#   PASS: simulated pause warning includes framework selection guidance
# === Framework Context: 28 passed, 0 failed ===
# Subtest: tests/framework-context.test.ts
ok 12 - tests/framework-context.test.ts
  ---
  duration_ms: 462.726273
  type: 'test'
  ...
# === Governance Stress Tests ===
#   PASS: GOV-01 bootstrap appears in permissive mode turn window
#   PASS: GOV-02 evidence and team blocks inject from turn 0
#   PASS: GOV-03 permissive mode suppresses detection warning block
#   PASS: GOV-04 out-of-order starts with info toast
#   PASS: GOV-04 severity escalates warning to error
#   PASS: GOV-05 session.idle emits drift toast when score < 30
#   PASS: GOV-06 framework conflict routing renders locked selection menu
#   PASS: GOV-07 prompt pins active GSD phase goal
#   PASS: Limited-mode conflict path is advisory, not hard deny
#   PASS: Simulated-pause path includes framework advisory without hard denial
#   PASS: GOV-08 ignored block includes compact tri-evidence
#   PASS: IGNORED tone adapts to strict/beginner posture
#   PASS: Tri-evidence formatter always renders SEQ/PLAN/HIER in one block
# === Governance Stress: 13 passed, 0 failed ===
# 13-condition result: 13/13 PASS
# Subtest: tests/governance-stress.test.ts
ok 13 - tests/governance-stress.test.ts
  ---
  duration_ms: 526.633841
  type: 'test'
  ...
# === Hierarchy Tree Tests ===
# --- stamps ---
#   PASS: generateStamp produces 12-char string
#   PASS: parseStamp round-trip minutes
#   PASS: parseStamp round-trip hours
#   PASS: parseStamp round-trip year
#   PASS: stampToEpoch produces valid epoch matching source date
#   PASS: makeNodeId uses t_, tc_, a_ prefixes
# --- crud ---
#   PASS: createTree returns { version:1, root:null, cursor:null }
#   PASS: createNode sets correct level and content
#   PASS: createNode sets status to active
#   PASS: createNode generates stamp from date
#   PASS: createNode initializes children as empty array
#   PASS: setRoot sets root and moves cursor to root
#   PASS: addChild adds child under parent and moves cursor to child
#   PASS: addChild on empty tree is no-op
#   PASS: moveCursor moves cursor to existing node
#   PASS: moveCursor on non-existent ID is no-op
#   PASS: markComplete sets status:complete and completed timestamp
# --- queries ---
#   PASS: findNode finds root by ID
#   PASS: findNode finds nested child
#   PASS: findNode returns null for missing ID
#   PASS: getAncestors returns [root] for root
#   PASS: getAncestors returns [trajectory, tactic, action] for deeply nested
#   PASS: getCursorNode returns node cursor points to
#   PASS: getCursorNode returns null on empty tree
#   PASS: toBrainProjection returns flat hierarchy from cursor path
#   PASS: flattenTree returns all nodes in DFS order
# --- staleness ---
#   PASS: classifyGap: <30min is healthy
#   PASS: classifyGap: 30min-2hr is warm
#   PASS: classifyGap: >2hr is stale
#   PASS: computeSiblingGap returns correct gap and sibling relationship
#   PASS: computeParentChildGap returns correct gap and parent-child relationship
#   PASS: detectGaps on tree with children returns gaps
#   PASS: detectGaps returns gaps sorted stale-first
#   PASS: detectGaps on empty tree returns []
# --- rendering ---
#   PASS: toAsciiTree on empty tree returns '(empty hierarchy)'
#   PASS: toAsciiTree includes level labels (Trajectory:, Tactic:, Action:)
#   PASS: toAsciiTree marks cursor with '<-- cursor'
#   PASS: toAsciiTree includes status markers ([>>] for active)
#   PASS: toActiveMdBody renders markdown with checkboxes and level labels
#   PASS: getTreeStats counts nodes correctly
# --- janitor ---
#   PASS: countCompleted returns 0 on empty tree
#   PASS: countCompleted returns correct count
#   PASS: summarizeBranch includes content and stamp
#   PASS: pruneCompleted replaces completed branches with summaries
#   PASS: pruneCompleted preserves non-completed branches
#   PASS: pruneCompleted moves cursor to root if cursor was in pruned branch
# --- io ---
#   PASS: treeExists returns false before save
#   PASS: saveTree + loadTree round-trips correctly
#   PASS: treeExists returns true after save
#   PASS: loadTree returns empty tree for missing file
# --- migration ---
#   PASS: migrateFromFlat with empty trajectory returns empty tree
#   PASS: migrateFromFlat with trajectory only creates 1-node tree
#   PASS: migrateFromFlat with trajectory+tactic creates 2-node tree
#   PASS: migrateFromFlat with all 3 creates 3-node tree, cursor at action
#   PASS: toBrainProjection of migrated tree matches original flat
# === Hierarchy Tree: 55 passed, 0 failed ===
# Subtest: tests/hierarchy-tree.test.ts
ok 14 - tests/hierarchy-tree.test.ts
  ---
  duration_ms: 332.334719
  type: 'test'
  ...
# === Init + Planning FS Tests ===
# --- planning-fs: init directory ---
#   PASS: planning dir created
#   PASS: index.md created
#   PASS: active.md created
#   PASS: archive dir created
# --- planning-fs: active.md roundtrip ---
#   PASS: session_id preserved
#   PASS: mode preserved
#   PASS: body preserved
# --- planning-fs: parse active.md ---
#   PASS: frontmatter parsed
#   PASS: body parsed
# --- planning-fs: archive session ---
#   PASS: 1 archive created
#   PASS: archive contains session ID
# --- planning-fs: update index.md ---
#   PASS: summary stored in manifest
#   PASS: summary in root INDEX.md
# --- planning-fs: reset active.md ---
#   PASS: session_id reset to empty
#   PASS: body reset to template
# --- init: creates project structure ---
#   PASS: hivemind dir created
#   PASS: index.md created
#   PASS: active.md created
#   PASS: brain.json created
#   PASS: config.json created
#   PASS: 10-commandments.md copied to docs/
# --- init: respects options ---
#   PASS: strict mode set
#   PASS: Vietnamese language set
#   PASS: brain state created
#   PASS: strict mode starts LOCKED
# --- init: idempotent ---
#   PASS: no spurious archives
# --- persistence: state roundtrip ---
#   PASS: no state initially
#   PASS: state exists after save
#   PASS: state loaded
#   PASS: session ID preserved
#   PASS: mode preserved
# === Init + Planning FS: 31 passed, 0 failed ===
# Subtest: tests/init-planning.test.ts
ok 15 - tests/init-planning.test.ts
  ---
  duration_ms: 606.899281
  type: 'test'
  ...
# === Integration Tests ===
# --- integration: full lifecycle workflow ---
# ğŸ HiveMind Context Governance â€” Initialization
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
#   Governance: assisted
#   Language: en
#   Expert Level: intermediate
#   Output Style: explanatory
#   Automation: assisted
# Creating planning directory...
#   âœ“ Copied 10 Commandments to /tmp/hm-integ-zsgdLI/.hivemind/docs/
#   âœ“ Plugin registered in opencode.json
#     â†’ OpenCode will auto-install on next launch
#   âœ“ Synced OpenCode assets to project target: /tmp/hm-integ-zsgdLI/.opencode
#     - commands: copied 3, skipped 0, invalid 0
#     - skills: copied 5, skipped 0, invalid 0
#     - agents: copied 1, skipped 0, invalid 0
#     - workflows: copied 1, skipped 0, invalid 0
#     - templates: copied 1, skipped 0, invalid 0
#     - prompts: copied 1, skipped 0, invalid 0
#     - references: copied 1, skipped 0, invalid 0
# âœ“ Planning directory created:
#   /tmp/hm-integ-zsgdLI/.hivemind/
#   â”œâ”€â”€ INDEX.md             (root state entry point)
#   â”œâ”€â”€ state/               (brain, hierarchy, anchors, tasks)
#   â”œâ”€â”€ memory/              (mems + manifest)
#   â”œâ”€â”€ sessions/
#   â”‚   â”œâ”€â”€ active/          (current session file)
#   â”‚   â”œâ”€â”€ manifest.json    (session registry)
#   â”‚   â””â”€â”€ archive/         (completed sessions)
#   â”œâ”€â”€ plans/               (plan registry)
#   â”œâ”€â”€ codemap/             (SOT manifest)
#   â”œâ”€â”€ codewiki/            (SOT manifest)
#   â”œâ”€â”€ docs/                (10-commandments.md)
#   â”œâ”€â”€ templates/
#   â”‚   â””â”€â”€ session.md       (session template)
#   â”œâ”€â”€ logs/                (runtime logs)
#   â””â”€â”€ config.json          (governance settings)
# Session session-1771005996558-wxp03p initialized.
# Status: OPEN
# ğŸ”” ASSISTED MODE â€” agents get warnings but can proceed.
# âœ… Done! Open OpenCode in this project â€” HiveMind is active.
#   PASS: state exists after init
#   PASS: assisted mode starts OPEN
#   PASS: declare_intent sets session focus
#   PASS: session mode is plan_driven
#   PASS: trajectory set
#   PASS: map_context updates tactic
#   PASS: tactic stored in state
#   PASS: context update counted
#   PASS: map_context updates action
#   PASS: action stored in state
#   PASS: second context update counted
#   PASS: tactic in active.md
#   PASS: action in active.md
#   PASS: no archives before compaction
#   PASS: compact_session archives session
#   PASS: one archive after compaction
#   PASS: session locked after compaction
#   PASS: turn count reset
#   PASS: summary stored in manifest
# --- integration: strict mode workflow ---
# ğŸ HiveMind Context Governance â€” Initialization
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
#   Governance: strict
#   Language: en
#   Expert Level: intermediate
#   Output Style: explanatory
#   Automation: assisted
# Creating planning directory...
#   âœ“ Copied 10 Commandments to /tmp/hm-integ-Lu0R6V/.hivemind/docs/
#   âœ“ Plugin registered in opencode.json
#     â†’ OpenCode will auto-install on next launch
#   âœ“ Synced OpenCode assets to project target: /tmp/hm-integ-Lu0R6V/.opencode
#     - commands: copied 3, skipped 0, invalid 0
#     - skills: copied 5, skipped 0, invalid 0
#     - agents: copied 1, skipped 0, invalid 0
#     - workflows: copied 1, skipped 0, invalid 0
#     - templates: copied 1, skipped 0, invalid 0
#     - prompts: copied 1, skipped 0, invalid 0
#     - references: copied 1, skipped 0, invalid 0
# âœ“ Planning directory created:
#   /tmp/hm-integ-Lu0R6V/.hivemind/
#   â”œâ”€â”€ INDEX.md             (root state entry point)
#   â”œâ”€â”€ state/               (brain, hierarchy, anchors, tasks)
#   â”œâ”€â”€ memory/              (mems + manifest)
#   â”œâ”€â”€ sessions/
#   â”‚   â”œâ”€â”€ active/          (current session file)
#   â”‚   â”œâ”€â”€ manifest.json    (session registry)
#   â”‚   â””â”€â”€ archive/         (completed sessions)
#   â”œâ”€â”€ plans/               (plan registry)
#   â”œâ”€â”€ codemap/             (SOT manifest)
#   â”œâ”€â”€ codewiki/            (SOT manifest)
#   â”œâ”€â”€ docs/                (10-commandments.md)
#   â”œâ”€â”€ templates/
#   â”‚   â””â”€â”€ session.md       (session template)
#   â”œâ”€â”€ logs/                (runtime logs)
#   â””â”€â”€ config.json          (governance settings)
# Session session-1771005996723-sjyrpg initialized.
# Status: LOCKED
# ğŸ”’ STRICT MODE â€” agents must call declare_intent before writing.
# âœ… Done! Open OpenCode in this project â€” HiveMind is active.
#   PASS: strict mode starts LOCKED
#   PASS: session unlocked after declare_intent
# --- integration: context level transitions ---
# ğŸ HiveMind Context Governance â€” Initialization
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
#   Governance: assisted
#   Language: en
#   Expert Level: intermediate
#   Output Style: explanatory
#   Automation: assisted
# Creating planning directory...
#   âœ“ Copied 10 Commandments to /tmp/hm-integ-up4ATK/.hivemind/docs/
#   âœ“ Plugin registered in opencode.json
#     â†’ OpenCode will auto-install on next launch
#   âœ“ Synced OpenCode assets to project target: /tmp/hm-integ-up4ATK/.opencode
#     - commands: copied 3, skipped 0, invalid 0
#     - skills: copied 5, skipped 0, invalid 0
#     - agents: copied 1, skipped 0, invalid 0
#     - workflows: copied 1, skipped 0, invalid 0
#     - templates: copied 1, skipped 0, invalid 0
#     - prompts: copied 1, skipped 0, invalid 0
#     - references: copied 1, skipped 0, invalid 0
# âœ“ Planning directory created:
#   /tmp/hm-integ-up4ATK/.hivemind/
#   â”œâ”€â”€ INDEX.md             (root state entry point)
#   â”œâ”€â”€ state/               (brain, hierarchy, anchors, tasks)
#   â”œâ”€â”€ memory/              (mems + manifest)
#   â”œâ”€â”€ sessions/
#   â”‚   â”œâ”€â”€ active/          (current session file)
#   â”‚   â”œâ”€â”€ manifest.json    (session registry)
#   â”‚   â””â”€â”€ archive/         (completed sessions)
#   â”œâ”€â”€ plans/               (plan registry)
#   â”œâ”€â”€ codemap/             (SOT manifest)
#   â”œâ”€â”€ codewiki/            (SOT manifest)
#   â”œâ”€â”€ docs/                (10-commandments.md)
#   â”œâ”€â”€ templates/
#   â”‚   â””â”€â”€ session.md       (session template)
#   â”œâ”€â”€ logs/                (runtime logs)
#   â””â”€â”€ config.json          (governance settings)
# Session session-1771005996790-vze2ah initialized.
# Status: OPEN
# ğŸ”” ASSISTED MODE â€” agents get warnings but can proceed.
# âœ… Done! Open OpenCode in this project â€” HiveMind is active.
#   PASS: trajectory updated
#   PASS: tactic updated
#   PASS: action updated
#   PASS: complete status recorded
# --- integration: drift score reset on context update ---
# ğŸ HiveMind Context Governance â€” Initialization
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
#   Governance: assisted
#   Language: en
#   Expert Level: intermediate
#   Output Style: explanatory
#   Automation: assisted
# Creating planning directory...
#   âœ“ Copied 10 Commandments to /tmp/hm-integ-soKz0x/.hivemind/docs/
#   âœ“ Plugin registered in opencode.json
#     â†’ OpenCode will auto-install on next launch
#   âœ“ Synced OpenCode assets to project target: /tmp/hm-integ-soKz0x/.opencode
#     - commands: copied 3, skipped 0, invalid 0
#     - skills: copied 5, skipped 0, invalid 0
#     - agents: copied 1, skipped 0, invalid 0
#     - workflows: copied 1, skipped 0, invalid 0
#     - templates: copied 1, skipped 0, invalid 0
#     - prompts: copied 1, skipped 0, invalid 0
#     - references: copied 1, skipped 0, invalid 0
# âœ“ Planning directory created:
#   /tmp/hm-integ-soKz0x/.hivemind/
#   â”œâ”€â”€ INDEX.md             (root state entry point)
#   â”œâ”€â”€ state/               (brain, hierarchy, anchors, tasks)
#   â”œâ”€â”€ memory/              (mems + manifest)
#   â”œâ”€â”€ sessions/
#   â”‚   â”œâ”€â”€ active/          (current session file)
#   â”‚   â”œâ”€â”€ manifest.json    (session registry)
#   â”‚   â””â”€â”€ archive/         (completed sessions)
#   â”œâ”€â”€ plans/               (plan registry)
#   â”œâ”€â”€ codemap/             (SOT manifest)
#   â”œâ”€â”€ codewiki/            (SOT manifest)
#   â”œâ”€â”€ docs/                (10-commandments.md)
#   â”œâ”€â”€ templates/
#   â”‚   â””â”€â”€ session.md       (session template)
#   â”œâ”€â”€ logs/                (runtime logs)
#   â””â”€â”€ config.json          (governance settings)
# Session session-1771005996924-whs73e initialized.
# Status: OPEN
# ğŸ”” ASSISTED MODE â€” agents get warnings but can proceed.
# âœ… Done! Open OpenCode in this project â€” HiveMind is active.
#   PASS: turn count reset after context update
#   PASS: drift score boosted after context update
# --- integration: compaction hook preserves hierarchy ---
# ğŸ HiveMind Context Governance â€” Initialization
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
#   Governance: assisted
#   Language: en
#   Expert Level: intermediate
#   Output Style: explanatory
#   Automation: assisted
# Creating planning directory...
#   âœ“ Copied 10 Commandments to /tmp/hm-integ-ayKKfj/.hivemind/docs/
#   âœ“ Plugin registered in opencode.json
#     â†’ OpenCode will auto-install on next launch
#   âœ“ Synced OpenCode assets to project target: /tmp/hm-integ-ayKKfj/.opencode
#     - commands: copied 3, skipped 0, invalid 0
#     - skills: copied 5, skipped 0, invalid 0
#     - agents: copied 1, skipped 0, invalid 0
#     - workflows: copied 1, skipped 0, invalid 0
#     - templates: copied 1, skipped 0, invalid 0
#     - prompts: copied 1, skipped 0, invalid 0
#     - references: copied 1, skipped 0, invalid 0
# âœ“ Planning directory created:
#   /tmp/hm-integ-ayKKfj/.hivemind/
#   â”œâ”€â”€ INDEX.md             (root state entry point)
#   â”œâ”€â”€ state/               (brain, hierarchy, anchors, tasks)
#   â”œâ”€â”€ memory/              (mems + manifest)
#   â”œâ”€â”€ sessions/
#   â”‚   â”œâ”€â”€ active/          (current session file)
#   â”‚   â”œâ”€â”€ manifest.json    (session registry)
#   â”‚   â””â”€â”€ archive/         (completed sessions)
#   â”œâ”€â”€ plans/               (plan registry)
#   â”œâ”€â”€ codemap/             (SOT manifest)
#   â”œâ”€â”€ codewiki/            (SOT manifest)
#   â”œâ”€â”€ docs/                (10-commandments.md)
#   â”œâ”€â”€ templates/
#   â”‚   â””â”€â”€ session.md       (session template)
#   â”œâ”€â”€ logs/                (runtime logs)
#   â””â”€â”€ config.json          (governance settings)
# Session session-1771005997000-o6skkf initialized.
# Status: OPEN
# ğŸ”” ASSISTED MODE â€” agents get warnings but can proceed.
# âœ… Done! Open OpenCode in this project â€” HiveMind is active.
#   PASS: compaction hook should add context
#   PASS: hierarchy should include trajectory
#   PASS: hierarchy should include tactic
#   PASS: hierarchy should include action
# --- integration: stale session auto-archived on lifecycle hook ---
#   PASS: state exists after stale archive
#   PASS: new session ID created after stale archive
#   PASS: hierarchy tree reset after stale auto-archive
#   PASS: archive has at least 1 file after stale archive
#   PASS: manifest contains auto-archived stale marker
# --- integration: first-run setup guidance includes deep recon protocol ---
#   PASS: setup block injected when config is missing
#   PASS: setup block includes recon protocol
#   PASS: setup block includes detected project name
#   PASS: setup block includes framework context
#   PASS: first-run setup guidance does not auto-create brain state
# --- integration: persistence migrates write_without_read_count ---
#   PASS: state exists before migration test
#   PASS: missing write_without_read_count migrates to 0
# --- integration: chain breaks injected into system prompt ---
#   PASS: output contains chain breaks warning
#   PASS: output mentions missing parent tactic
# --- integration: tool activation suggests declare_intent when locked ---
#   PASS: output suggests declare_intent tool
#   PASS: output mentions LOCKED status
# --- round2: session metadata persists through lifecycle ---
#   PASS: state.session.date is today's date
#   PASS: state.session.by_ai is true
# --- round2: active session file keeps hierarchy/log structure ---
#   PASS: active session contains '\#\# Hierarchy' section
#   PASS: active session contains '\#\# Log' section
#   PASS: active session contains focus text
# --- round2: compact_session generates export files ---
#   PASS: at least 1 .json export file exists
#   PASS: at least 1 .md export file exists
# --- round2: long session warning injected at threshold ---
#   PASS: output contains compact_session suggestion at threshold
# --- round3: scan_hierarchy returns structured state ---
#   PASS: scan_hierarchy returns session info
#   PASS: scan_hierarchy returns hierarchy levels
# --- round3: save_anchor persists and survives compaction ---
#   PASS: save_anchor returns confirmation
#   PASS: anchor survives session compaction
# --- round3: anchors injected into system prompt ---
#   PASS: system prompt contains anchors from save_anchor
# --- round3: think_back includes all context sections ---
#   PASS: think_back includes hierarchy
#   PASS: think_back includes anchors
# --- round3: check_drift shows healthy when aligned ---
#   PASS: scan_hierarchy+drift shows healthy when trajectory/tactic/action aligned
#   PASS: scan_hierarchy+drift shows intact chain when hierarchy complete
# --- round3: check_drift warns when drifting ---
#   PASS: scan_hierarchy+drift warns when drift score in warning range
# --- round3: full cognitive mesh workflow ---
#   PASS: think_back integrates all cognitive mesh components
#   PASS: scan_hierarchy shows full cognitive mesh state
#   PASS: scan_hierarchy+drift confirms healthy cognitive mesh
#   PASS: anchors survive compaction in full workflow
# --- round4: save_mem persists and survives compaction ---
#   PASS: save_mem stores memory in mems.json
#   PASS: memory persists on disk
#   PASS: memory survives session compaction
# --- round4: recall_mems searches across sessions ---
#   PASS: recall_mems finds mems from previous sessions
#   PASS: recall_mems filters by shelf correctly
# --- round4: list_shelves shows accurate overview ---
#   PASS: recall_mems list mode shows total count
#   PASS: recall_mems list mode shows shelf breakdown
# --- round4: auto-mem on compaction ---
#   PASS: compact_session creates context mem automatically
#   PASS: auto-mem contains session summary
# --- round4: system prompt uses <hivemind> tag ---
#   PASS: system prompt uses <hivemind> tags
#   PASS: system prompt does NOT use old <hivemind-governance> tags
# --- round4: full mems brain workflow ---
#   PASS: full workflow: save â†’ recall finds memory
#   PASS: full workflow: recall across sessions finds both manual + auto mems
#   PASS: full workflow: recall_mems list mode shows all shelf categories
# --- round5: bootstrap block appears in system prompt when LOCKED ---
#   PASS: bootstrap block appears with XML tags when LOCKED
#   PASS: bootstrap block contains all 3 core tool names
#   PASS: bootstrap block contains workflow instructions
#   PASS: bootstrap block contains tool listing
#   PASS: bootstrap block contains LOCKED warning for strict mode
# --- round5: bootstrap block remains in early open-turn window ---
#   PASS: bootstrap block appears when session is OPEN but still in early turn window
#   PASS: regular hivemind block still present when OPEN
# --- round5: bootstrap block disappears after turn_count > 2 ---
#   PASS: bootstrap block does NOT appear when turn_count > 2 (even if LOCKED)
# --- round5: bootstrap block in assisted mode ---
#   PASS: bootstrap block appears in assisted mode when LOCKED
#   PASS: bootstrap block uses softer wording for assisted mode
# --- round5: bootstrap block appears in permissive mode at turn 0 ---
#   PASS: bootstrap block appears in permissive mode during turn window
# --- round5: permissive suppresses pressure and keeps navigation ---
#   PASS: permissive mode still includes navigation context
#   PASS: permissive mode suppresses detection-pressure warnings
# --- round5: language routing keeps tool names English ---
#   PASS: localized surrounding guidance is rendered in configured language
#   PASS: tool names remain English in localized output
# --- round6: framework conflict pins goal and menu in prompt ---
#   PASS: session prompt pins active gsd phase goal
#   PASS: session prompt includes locked framework selection menu metadata
# --- round6: framework limited mode gating ---
#   PASS: write remains non-blocking in limited mode without framework selection
#   PASS: limited mode message includes framework advisory
#   PASS: limited mode includes framework selection guidance
#   PASS: write allowed after framework selection metadata is provided
# --- round5: session.idle drives stale toasts and compaction stays info ---
#   PASS: idle emits drift toast when score < 30 and turns >= 10
#   PASS: at least one toast emitted for drift detection
#   PASS: compaction toast handled by compaction hook (not event-handler)
# --- round5: compaction hook emits info toast ---
#   PASS: compaction hook injects context
#   PASS: compaction hook does not escalate beyond info
# === Integration: 109 passed, 0 failed ===
# Subtest: tests/integration.test.ts
ok 16 - tests/integration.test.ts
  ---
  duration_ms: 2728.629677
  type: 'test'
  ...
# === manifest.test.ts ===
# --- Core chain ---
#   PASS: chain has 5 relation edges
#   PASS: codemap governs plans
#   PASS: codewiki governs plans
#   PASS: tasks materialize sub_tasks
# --- Session dedup ---
#   PASS: duplicate stamp collapsed
#   PASS: kept merged entry for stamp 111
#   PASS: linked plans merged and deduped
#   PASS: exactly one active session remains
#   PASS: active stamp preserved when valid
# --- Register session ---
#   PASS: first register creates one session
#   PASS: first register sets active stamp
#   PASS: second register appends second session
#   PASS: second register sets new active stamp
#   PASS: old active session archived
#   PASS: register same stamp updates, no duplicate
#   PASS: existing stamp gets updated file
#   PASS: existing stamp updates linked plans
# --- Session-plan linking ---
#   PASS: link operation reports success
#   PASS: session links to plan
#   PASS: plan links to session
#   PASS: session link is deduped
#   PASS: plan link is deduped
# --- Memory sync ---
#   PASS: decisions count is synced
#   PASS: decisions last_updated uses max
#   PASS: patterns count is synced
# --- Generic CRUD + ensure ---
#   PASS: root manifest created
#   PASS: state manifest created
#   PASS: sessions manifest created
#   PASS: plans manifest created
#   PASS: memory manifest created
#   PASS: codemap manifest created
#   PASS: codewiki manifest created
#   PASS: root manifest structure version is 2.0.0
#   PASS: codemap marked as SOT
#   PASS: codewiki marked as SOT
#   PASS: root includes materialization chain
#   PASS: generic write/read roundtrip works
#   PASS: written manifest is persisted to disk
# --- Results: 38 passed, 0 failed ---
# Subtest: tests/manifest.test.ts
ok 17 - tests/manifest.test.ts
  ---
  duration_ms: 330.049568
  type: 'test'
  ...
# === migration.test.ts ===
# --- migration: legacy -> v2 ---
#   PASS: migration reports migrated=true
#   PASS: brain moved to state/brain.json
#   PASS: hierarchy moved to state/hierarchy.json
#   PASS: anchors moved to state/anchors.json
#   PASS: mems moved to memory/mems.json
#   PASS: 10-commandments moved to docs/
#   PASS: root manifest exists
#   PASS: state manifest exists
#   PASS: memory manifest exists
#   PASS: sessions manifest exists
#   PASS: plans manifest exists
#   PASS: INDEX.md generated at root
#   PASS: duplicate session stamps deduplicated
#   PASS: active stamp preserved
#   PASS: active session moved to sessions/active/
#   PASS: migrated session has YAML frontmatter
# --- migration: skip already-new ---
#   PASS: already-new structure is not migrated
#   PASS: reason is already-new-structure
# --- migration: skip non-legacy ---
#   PASS: empty project is not migrated
#   PASS: reason is not-legacy
# --- Results: 20 passed, 0 failed ---
# Subtest: tests/migration.test.ts
ok 18 - tests/migration.test.ts
  ---
  duration_ms: 392.758074
  type: 'test'
  ...
# === paths.test.ts ===
# --- Constants ---
#   PASS: STRUCTURE_VERSION is 2.0.0
#   PASS: HIVEMIND_DIR is .hivemind
# --- getHivemindPaths ---
#   PASS: root path
#   PASS: config path
#   PASS: index path
#   PASS: root manifest path
#   PASS: stateDir path
#   PASS: state manifest path
#   PASS: brain path
#   PASS: hierarchy path
#   PASS: anchors path
#   PASS: tasks path
#   PASS: memoryDir path
#   PASS: memory manifest path
#   PASS: mems path
#   PASS: sessionsDir path
#   PASS: sessions manifest path
#   PASS: activeDir path
#   PASS: archiveDir path
#   PASS: exportsDir path
#   PASS: plansDir path
#   PASS: plans manifest path
#   PASS: codemapDir path
#   PASS: codemap manifest path
#   PASS: codewikiDir path
#   PASS: codewiki manifest path
#   PASS: logsDir path
#   PASS: docsDir path
#   PASS: templatesDir path
#   PASS: session template path
#   PASS: all paths are under .hivemind/
# --- getLegacyPaths ---
#   PASS: legacy root
#   PASS: legacy brain at root level
#   PASS: legacy hierarchy at root
#   PASS: legacy anchors at root
#   PASS: legacy mems at root
#   PASS: legacy config same location
# --- isLegacyStructure ---
#   PASS: empty dir is not legacy
#   PASS: brain.json at root = legacy
#   PASS: brain.json at root + state/ exists = not legacy
# --- isNewStructure ---
#   PASS: empty dir is not new structure
#   PASS: state/ without manifest is not new structure
#   PASS: state/ + manifest.json = new structure
# --- hivemindExists ---
#   PASS: no .hivemind/ = false
#   PASS: .hivemind/ exists = true
# --- slugify ---
#   PASS: typical trajectory
#   PASS: simple two words
#   PASS: empty string
#   PASS: trims whitespace to slug
#   PASS: lowercases
#   PASS: collapses multiple hyphens
#   PASS: strips special chars
#   PASS: respects maxLength
#   PASS: no trailing hyphen after truncation
# --- buildSessionFilename ---
#   PASS: full session filename
#   PASS: Date object input
#   PASS: ISO timestamp input
#   PASS: empty trajectory fallback
# --- buildArchiveFilename ---
#   PASS: archive filename matches session filename
# --- getAllDirectories ---
#   PASS: 13 directories in structure
#   PASS: root is first
#   PASS: includes state/
#   PASS: includes memory/
#   PASS: includes sessions/
#   PASS: includes sessions/active/
#   PASS: includes sessions/archive/
#   PASS: includes sessions/archive/exports/
#   PASS: includes plans/
#   PASS: includes codemap/
#   PASS: includes codewiki/
#   PASS: includes logs/
#   PASS: includes docs/
#   PASS: includes templates/
# --- getActiveSessionPath ---
#   PASS: no manifest returns null
#   PASS: null active_stamp returns null
#   PASS: resolves active session path via manifest
#   PASS: missing stamp in sessions returns null
#   PASS: corrupt manifest returns null
# --- Purity ---
#   PASS: different roots give different paths
#   PASS: brain paths differ per root
#   PASS: same root gives same paths
#   PASS: deterministic
# --- Results: 82 passed, 0 failed ---
# Subtest: tests/paths.test.ts
ok 19 - tests/paths.test.ts
  ---
  duration_ms: 332.016113
  type: 'test'
  ...
# Subtest: FileLock behavior
    # Subtest: acquires lock successfully
    ok 1 - acquires lock successfully
      ---
      duration_ms: 6.436906
      type: 'test'
      ...
    # Subtest: waits for lock release
    ok 2 - waits for lock release
      ---
      duration_ms: 323.1488
      type: 'test'
      ...
    # Subtest: cleans up stale lock
    ok 3 - cleans up stale lock
      ---
      duration_ms: 4.197939
      type: 'test'
      ...
    1..3
ok 20 - FileLock behavior
  ---
  duration_ms: 335.722322
  type: 'test'
  ...
# === Round 3 Tools Tests ===
# --- anchors: persistence + CRUD ---
#   PASS: loadAnchors returns empty state for new project
#   PASS: addAnchor adds to state
#   PASS: addAnchor replaces existing key
#   PASS: removeAnchor removes by key
#   PASS: saveAnchors + loadAnchors roundtrip
#   PASS: formatAnchorsForPrompt with 0 anchors returns empty string
#   PASS: formatAnchorsForPrompt includes key-value pairs
#   PASS: formatAnchorsForPrompt includes immutable-anchors tags
# --- scan_hierarchy: structured read ---
#   PASS: returns error message when no session
#   PASS: returns structured text with session info
#   PASS: returns hierarchy levels when set
#   PASS: returns metrics
#   PASS: returns anchors section
#   PASS: returns '(not set)' for empty hierarchy levels
# --- save_anchor: tool tests ---
#   PASS: save_anchor saves to anchors.json
#   PASS: save_anchor replaces existing key
#   PASS: save_anchor returns confirmation with count
#   PASS: anchors survive session compaction
#   PASS: system prompt includes anchors after save
#   PASS: system prompt includes immutable-anchors tag
# --- think_back: context refresh ---
#   PASS: think_back returns error when no session
#   PASS: think_back includes trajectory in output
#   PASS: think_back includes session health metrics
#   PASS: think_back includes anchors when present
#   PASS: think_back includes chain break warnings
#   PASS: think_back includes plan section from active.md
# --- scan_hierarchy include_drift: drift report ---
#   PASS: scan_hierarchy+drift returns error when no session
#   PASS: scan_hierarchy+drift shows drift score with emoji
#   PASS: scan_hierarchy+drift shows drift report section
#   PASS: scan_hierarchy+drift shows chain integrity pass when intact
#   PASS: scan_hierarchy+drift shows chain integrity fail when broken
#   PASS: scan_hierarchy+drift shows recommendation based on drift score
# === Round 3: 32 passed, 0 failed ===
# Subtest: tests/round3-tools.test.ts
ok 21 - tests/round3-tools.test.ts
  ---
  duration_ms: 653.250606
  type: 'test'
  ...
# === Round 4 Mems Tests ===
# --- mems: persistence + CRUD ---
#   PASS: loadMems returns empty state for new project
#   PASS: addMem adds to state
#   PASS: addMem generates unique ID (starts with "mem_")
#   PASS: addMem preserves tags
#   PASS: removeMem removes by ID
#   PASS: removeMem no-ops for unknown ID (same length)
#   PASS: saveMems + loadMems roundtrip
#   PASS: generateMemId format matches /^mem_\\d+_[a-z0-9]{4}$/
#   PASS: generateMemId generates unique IDs (2 calls differ)
#   PASS: getShelfSummary counts correctly
# --- mems: search ---
#   PASS: searchMems matches content substring (case-insensitive)
#   PASS: searchMems matches tags
#   PASS: searchMems filters by shelf
#   PASS: searchMems returns empty for no match
#   PASS: searchMems returns newest first (check order)
#   PASS: getMemsByShelf filters correctly
# --- mems: prompt formatting ---
#   PASS: formatMemsForPrompt returns empty string for 0 mems
#   PASS: formatMemsForPrompt shows count and shelf breakdown
#   PASS: formatMemsForPrompt includes "recall_mems" suggestion
#   PASS: formatMemsForPrompt handles multiple shelves
# --- save_mem: tool tests ---
#   PASS: save_mem saves to mems.json
#   PASS: save_mem with tags stores tag array
#   PASS: save_mem returns confirmation with shelf and count
#   PASS: save_mem assigns unique IDs
#   PASS: mems survive session compaction
# --- recall_mems list mode: shelf listing ---
#   PASS: recall_mems list mode returns empty message for no mems
#   PASS: recall_mems list mode shows shelf counts
#   PASS: recall_mems list mode shows recent memories
# --- recall_mems: tool tests ---
#   PASS: recall_mems returns empty message when no mems
#   PASS: recall_mems finds matching content
#   PASS: recall_mems finds matching tags
#   PASS: recall_mems returns no-match message for unknown query
#   PASS: recall_mems filters by shelf when provided
#   PASS: recall_mems caps results at 5
# --- hook integrations: mems brain ---
#   PASS: compact_session auto-saves context mem
#   PASS: auto-saved mem has shelf "context"
#   PASS: auto-saved mem has "auto-compact" tag
#   PASS: system prompt includes <hivemind> tag after save_mem
#   PASS: system prompt includes session status and metrics
#   PASS: mems count shown after compaction context injection
# === Round 4: 40 passed, 0 failed ===
# Subtest: tests/round4-mems.test.ts
ok 22 - tests/round4-mems.test.ts
  ---
  duration_ms: 851.735568
  type: 'test'
  ...
# === Scan Actions Tests ===
# --- scan-actions: analyze json ---
#   PASS: json action is analyze
#   PASS: project name detected from package.json
#   PASS: framework conflict detected as both
#   PASS: bmad signal detected
#   PASS: stack hints include TypeScript + React
# --- scan-actions: recommend text ---
#   PASS: recommend output has recommendation header
#   PASS: recommend output includes framework conflict guidance
#   PASS: recommend output includes lifecycle commands
# --- scan-actions: orchestrate bootstrap ---
#   PASS: json action is orchestrate
#   PASS: orchestrate reports anchors added
#   PASS: orchestrate reports memory saved
#   PASS: orchestrate saved project-stack and framework-context anchors
#   PASS: orchestrate saved project-intel memory with brownfield tag
#   PASS: orchestrate is non-destructive to config
# === Scan Actions: 14 passed, 0 failed ===
# Subtest: tests/scan-actions.test.ts
ok 23 - tests/scan-actions.test.ts
  ---
  duration_ms: 597.255144
  type: 'test'
  ...
# === Schema Tests ===
# --- brain-state: creation ---
#   PASS: session id set
#   PASS: default mode is plan_driven
#   PASS: inherits config mode
#   PASS: assisted mode starts OPEN
#   PASS: starts with 0 turns
#   PASS: starts with 100 drift score
#   PASS: version set
# --- brain-state: strict starts locked ---
#   PASS: strict mode starts LOCKED
# --- brain-state: unlock ---
#   PASS: starts locked
#   PASS: unlocked after unlockSession
# --- brain-state: lock ---
#   PASS: starts unlocked
#   PASS: locked after lockSession
# --- brain-state: turn counting ---
#   PASS: incremented to 1
#   PASS: incremented to 3
#   PASS: reset to 0
# --- brain-state: hierarchy update ---
#   PASS: trajectory set
#   PASS: context update counted
#   PASS: tactic set
#   PASS: context update counted again
# --- brain-state: file tracking ---
#   PASS: 1 file tracked
#   PASS: duplicate not added
#   PASS: 2 files tracked
# --- brain-state: drift score ---
#   PASS: fresh state = 100
#   PASS: drift decreases with turns
#   PASS: context update boosts drift score
# --- brain-state: drift warning ---
#   PASS: no warning at start
#   PASS: warning triggered at high turns + low drift
# --- hierarchy: state operations ---
#   PASS: empty trajectory
#   PASS: trajectory updated
#   PASS: tactic updated
#   PASS: trajectory depth = 1
#   PASS: tactic depth = 2
#   PASS: action depth = 3
# --- brain-state: session ID ---
#   PASS: starts with session-
#   PASS: unique IDs generated
# === Schema: 35 passed, 0 failed ===
# Subtest: tests/schemas.test.ts
ok 24 - tests/schemas.test.ts
  ---
  duration_ms: 314.405013
  type: 'test'
  ...
# === SDK Foundation Tests ===
# --- sdk-foundation: sdk context module ---
#   PASS: getClient returns null initially
#   PASS: getShell returns null initially
#   PASS: getServerUrl returns null initially
#   PASS: getProject returns null initially
#   PASS: isSdkAvailable returns false initially
#   PASS: getClient returns client after init
#   PASS: getShell returns shell after init
#   PASS: getServerUrl returns serverUrl after init
#   PASS: getProject returns project after init
#   PASS: isSdkAvailable returns true after init
#   PASS: getClient returns null after reset
#   PASS: isSdkAvailable returns false after reset
#   PASS: getClient returns client after partial init
#   PASS: getShell returns null after partial init
# --- sdk-foundation: withClient graceful fallback ---
#   PASS: withClient returns fallback when client null
#   PASS: withClient returns undefined when client null and no fallback
#   PASS: withClient passes client to callback
#   PASS: withClient returns callback result when client available
# SDK client error: Error: oops
#     at <anonymous> (/app/tests/sdk-foundation.test.ts:123:11)
#     at withClient (/app/src/hooks/sdk-context.ts:91:18)
#     at test_withClientFallback (/app/tests/sdk-foundation.test.ts:122:25)
#     at async main (/app/tests/sdk-foundation.test.ts:326:3)
#   PASS: withClient returns fallback when callback throws
# SDK client error: Error: oops
#     at <anonymous> (/app/tests/sdk-foundation.test.ts:128:11)
#     at withClient (/app/src/hooks/sdk-context.ts:91:18)
#     at test_withClientFallback (/app/tests/sdk-foundation.test.ts:127:25)
#     at async main (/app/tests/sdk-foundation.test.ts:326:3)
#   PASS: withClient returns undefined when callback throws and no fallback
# --- sdk-foundation: plugin entry wiring ---
#   PASS: index.ts calls initSdkContext
#   PASS: index.ts wires event handler
# --- sdk-foundation: event handler ---
#   PASS: createEventHandler returns a function
#   PASS: handles session.created
#   PASS: handles session.idle
#   PASS: handles session.compacted
#   PASS: handles file.edited
#   PASS: handles session.diff
#   PASS: handles unknown event
#   PASS: handles null event (catches error)
# --- sdk-foundation: idle escalation + compaction info toast ---
#   PASS: idle drift toast emitted when score < 30 and turns >= 10
#   PASS: at least one drift toast emitted
#   PASS: compaction toast handled by compaction hook (not event-handler)
#   PASS: compaction counter incremented
# --- sdk-foundation: architecture boundary ---
#   PASS: check-sdk-boundary.sh is executable
#   PASS: src/lib/ clean of @opencode-ai imports
#   PASS: src/hooks/ contains @opencode-ai imports (boundary works)
# --- sdk-foundation: backward compatibility ---
#   PASS: Tools exports count: 10 (>= 10)
#   PASS: createDeclareIntentTool exported
#   PASS: Hooks exports count: 13 (>= 13)
#   PASS: createSessionLifecycleHook exported
#   PASS: createEventHandler exported
#   PASS: initSdkContext exported from hooks barrel
#   PASS: getClient exported from hooks barrel
# --- sdk-foundation: double init and concurrency ---
#   PASS: initSdkContext updates context on re-call
#   PASS: all concurrent calls completed
#   PASS: all concurrent calls returned success
#   PASS: all concurrent callbacks executed
# === SDK Foundation: 48 passed, 0 failed ===
# Subtest: tests/sdk-foundation.test.ts
ok 25 - tests/sdk-foundation.test.ts
  ---
  duration_ms: 723.57214
  type: 'test'
  ...
# === Self-Rate Tool Tests ===
# --- self-rate: basic rating ---
#   PASS: fails without any state
#   PASS: records rating
#   PASS: includes turn number
#   PASS: shows positive feedback for high score
#   PASS: state exists
#   PASS: one rating stored
#   PASS: score is 8
#   PASS: turn number recorded
# --- self-rate: with reason ---
# ğŸ HiveMind Context Governance â€” Initialization
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
#   Governance: assisted
#   Language: en
#   Expert Level: intermediate
#   Output Style: explanatory
#   Automation: assisted
# Creating planning directory...
#   âœ“ Copied 10 Commandments to /tmp/hm-selfrate-ONFpGT/.hivemind/docs/
#   âœ“ Plugin registered in opencode.json
#     â†’ OpenCode will auto-install on next launch
#   âœ“ Synced OpenCode assets to project target: /tmp/hm-selfrate-ONFpGT/.opencode
#     - commands: copied 3, skipped 0, invalid 0
#     - skills: copied 5, skipped 0, invalid 0
#     - agents: copied 1, skipped 0, invalid 0
#     - workflows: copied 1, skipped 0, invalid 0
#     - templates: copied 1, skipped 0, invalid 0
#     - prompts: copied 1, skipped 0, invalid 0
#     - references: copied 1, skipped 0, invalid 0
# âœ“ Planning directory created:
#   /tmp/hm-selfrate-ONFpGT/.hivemind/
#   â”œâ”€â”€ INDEX.md             (root state entry point)
#   â”œâ”€â”€ state/               (brain, hierarchy, anchors, tasks)
#   â”œâ”€â”€ memory/              (mems + manifest)
#   â”œâ”€â”€ sessions/
#   â”‚   â”œâ”€â”€ active/          (current session file)
#   â”‚   â”œâ”€â”€ manifest.json    (session registry)
#   â”‚   â””â”€â”€ archive/         (completed sessions)
#   â”œâ”€â”€ plans/               (plan registry)
#   â”œâ”€â”€ codemap/             (SOT manifest)
#   â”œâ”€â”€ codewiki/            (SOT manifest)
#   â”œâ”€â”€ docs/                (10-commandments.md)
#   â”œâ”€â”€ templates/
#   â”‚   â””â”€â”€ session.md       (session template)
#   â”œâ”€â”€ logs/                (runtime logs)
#   â””â”€â”€ config.json          (governance settings)
# Session session-1771005998956-jhuc6l initialized.
# Status: OPEN
# ğŸ”” ASSISTED MODE â€” agents get warnings but can proceed.
# âœ… Done! Open OpenCode in this project â€” HiveMind is active.
#   PASS: records rating
#   PASS: includes reason
#   PASS: shows positive feedback for score 7
#   PASS: one rating stored
#   PASS: score is 7
#   PASS: reason stored
#   PASS: turn context stored
#   PASS: timestamp recorded
# --- self-rate: low score warning ---
# ğŸ HiveMind Context Governance â€” Initialization
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
#   Governance: assisted
#   Language: en
#   Expert Level: intermediate
#   Output Style: explanatory
#   Automation: assisted
# Creating planning directory...
#   âœ“ Copied 10 Commandments to /tmp/hm-selfrate-ZHZAEl/.hivemind/docs/
#   âœ“ Plugin registered in opencode.json
#     â†’ OpenCode will auto-install on next launch
#   âœ“ Synced OpenCode assets to project target: /tmp/hm-selfrate-ZHZAEl/.opencode
#     - commands: copied 3, skipped 0, invalid 0
#     - skills: copied 5, skipped 0, invalid 0
#     - agents: copied 1, skipped 0, invalid 0
#     - workflows: copied 1, skipped 0, invalid 0
#     - templates: copied 1, skipped 0, invalid 0
#     - prompts: copied 1, skipped 0, invalid 0
#     - references: copied 1, skipped 0, invalid 0
# âœ“ Planning directory created:
#   /tmp/hm-selfrate-ZHZAEl/.hivemind/
#   â”œâ”€â”€ INDEX.md             (root state entry point)
#   â”œâ”€â”€ state/               (brain, hierarchy, anchors, tasks)
#   â”œâ”€â”€ memory/              (mems + manifest)
#   â”œâ”€â”€ sessions/
#   â”‚   â”œâ”€â”€ active/          (current session file)
#   â”‚   â”œâ”€â”€ manifest.json    (session registry)
#   â”‚   â””â”€â”€ archive/         (completed sessions)
#   â”œâ”€â”€ plans/               (plan registry)
#   â”œâ”€â”€ codemap/             (SOT manifest)
#   â”œâ”€â”€ codewiki/            (SOT manifest)
#   â”œâ”€â”€ docs/                (10-commandments.md)
#   â”œâ”€â”€ templates/
#   â”‚   â””â”€â”€ session.md       (session template)
#   â”œâ”€â”€ logs/                (runtime logs)
#   â””â”€â”€ config.json          (governance settings)
# Session session-1771005999072-q16d0l initialized.
# Status: OPEN
# ğŸ”” ASSISTED MODE â€” agents get warnings but can proceed.
# âœ… Done! Open OpenCode in this project â€” HiveMind is active.
#   PASS: records low rating
#   PASS: shows warning for low score
#   PASS: suggests compact_session for low score
# --- self-rate: multiple ratings ---
# ğŸ HiveMind Context Governance â€” Initialization
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
#   Governance: assisted
#   Language: en
#   Expert Level: intermediate
#   Output Style: explanatory
#   Automation: assisted
# Creating planning directory...
#   âœ“ Copied 10 Commandments to /tmp/hm-selfrate-Kn3kOo/.hivemind/docs/
#   âœ“ Plugin registered in opencode.json
#     â†’ OpenCode will auto-install on next launch
#   âœ“ Synced OpenCode assets to project target: /tmp/hm-selfrate-Kn3kOo/.opencode
#     - commands: copied 3, skipped 0, invalid 0
#     - skills: copied 5, skipped 0, invalid 0
#     - agents: copied 1, skipped 0, invalid 0
#     - workflows: copied 1, skipped 0, invalid 0
#     - templates: copied 1, skipped 0, invalid 0
#     - prompts: copied 1, skipped 0, invalid 0
#     - references: copied 1, skipped 0, invalid 0
# âœ“ Planning directory created:
#   /tmp/hm-selfrate-Kn3kOo/.hivemind/
#   â”œâ”€â”€ INDEX.md             (root state entry point)
#   â”œâ”€â”€ state/               (brain, hierarchy, anchors, tasks)
#   â”œâ”€â”€ memory/              (mems + manifest)
#   â”œâ”€â”€ sessions/
#   â”‚   â”œâ”€â”€ active/          (current session file)
#   â”‚   â”œâ”€â”€ manifest.json    (session registry)
#   â”‚   â””â”€â”€ archive/         (completed sessions)
#   â”œâ”€â”€ plans/               (plan registry)
#   â”œâ”€â”€ codemap/             (SOT manifest)
#   â”œâ”€â”€ codewiki/            (SOT manifest)
#   â”œâ”€â”€ docs/                (10-commandments.md)
#   â”œâ”€â”€ templates/
#   â”‚   â””â”€â”€ session.md       (session template)
#   â”œâ”€â”€ logs/                (runtime logs)
#   â””â”€â”€ config.json          (governance settings)
# Session session-1771005999134-v93owl initialized.
# Status: OPEN
# ğŸ”” ASSISTED MODE â€” agents get warnings but can proceed.
# âœ… Done! Open OpenCode in this project â€” HiveMind is active.
#   PASS: three ratings stored
#   PASS: first rating score is 8
#   PASS: second rating score is 6
#   PASS: third rating score is 9
#   PASS: first at turn 0
#   PASS: second at turn 5
#   PASS: third at turn 10
# --- self-rate: score validation ---
# ğŸ HiveMind Context Governance â€” Initialization
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
#   Governance: assisted
#   Language: en
#   Expert Level: intermediate
#   Output Style: explanatory
#   Automation: assisted
# Creating planning directory...
#   âœ“ Copied 10 Commandments to /tmp/hm-selfrate-DplLuH/.hivemind/docs/
#   âœ“ Plugin registered in opencode.json
#     â†’ OpenCode will auto-install on next launch
#   âœ“ Synced OpenCode assets to project target: /tmp/hm-selfrate-DplLuH/.opencode
#     - commands: copied 3, skipped 0, invalid 0
#     - skills: copied 5, skipped 0, invalid 0
#     - agents: copied 1, skipped 0, invalid 0
#     - workflows: copied 1, skipped 0, invalid 0
#     - templates: copied 1, skipped 0, invalid 0
#     - prompts: copied 1, skipped 0, invalid 0
#     - references: copied 1, skipped 0, invalid 0
# âœ“ Planning directory created:
#   /tmp/hm-selfrate-DplLuH/.hivemind/
#   â”œâ”€â”€ INDEX.md             (root state entry point)
#   â”œâ”€â”€ state/               (brain, hierarchy, anchors, tasks)
#   â”œâ”€â”€ memory/              (mems + manifest)
#   â”œâ”€â”€ sessions/
#   â”‚   â”œâ”€â”€ active/          (current session file)
#   â”‚   â”œâ”€â”€ manifest.json    (session registry)
#   â”‚   â””â”€â”€ archive/         (completed sessions)
#   â”œâ”€â”€ plans/               (plan registry)
#   â”œâ”€â”€ codemap/             (SOT manifest)
#   â”œâ”€â”€ codewiki/            (SOT manifest)
#   â”œâ”€â”€ docs/                (10-commandments.md)
#   â”œâ”€â”€ templates/
#   â”‚   â””â”€â”€ session.md       (session template)
#   â”œâ”€â”€ logs/                (runtime logs)
#   â””â”€â”€ config.json          (governance settings)
# Session session-1771005999232-z32vsv initialized.
# Status: OPEN
# ğŸ”” ASSISTED MODE â€” agents get warnings but can proceed.
# âœ… Done! Open OpenCode in this project â€” HiveMind is active.
#   PASS: accepts minimum score 1
#   PASS: accepts maximum score 10
# === Self-Rate: 28 passed, 0 failed ===
# Subtest: tests/self-rate.test.ts
ok 26 - tests/self-rate.test.ts
  ---
  duration_ms: 927.621025
  type: 'test'
  ...
# === Session Export Tests ===
# --- session-export: generateExportData ---
#   PASS: id matches session id
#   PASS: mode matches session mode
#   PASS: date matches session date
#   PASS: meta_key defaults to empty
#   PASS: role defaults to empty
#   PASS: by_ai defaults to true
#   PASS: turns matches turn count
#   PASS: files_touched has 2 entries
#   PASS: trajectory preserved
#   PASS: tactic preserved
#   PASS: action preserved
#   PASS: summary matches
#   PASS: one rating in export
#   PASS: rating score preserved
# --- session-export: generateJsonExport ---
#   PASS: JSON parses with correct id
#   PASS: JSON parses with correct summary
#   PASS: files_touched is array in JSON
#   PASS: hierarchy in JSON
# --- session-export: generateMarkdownExport ---
#   PASS: markdown has title
#   PASS: markdown has metadata section
#   PASS: markdown has metrics section
#   PASS: markdown has hierarchy section
#   PASS: markdown has trajectory
#   PASS: markdown has files section
#   PASS: markdown lists files
#   PASS: markdown has ratings section
#   PASS: markdown shows rating score
#   PASS: markdown shows rating reason
#   PASS: markdown has summary section
#   PASS: markdown shows summary text
#   PASS: markdown has session content
#   PASS: markdown includes session body
# === Session Export: 32 passed, 0 failed ===
# Subtest: tests/session-export.test.ts
ok 27 - tests/session-export.test.ts
  ---
  duration_ms: 319.96272
  type: 'test'
  ...
# \#   PASS: date is set to today's YYYY-MM-DD
# \#   PASS: meta_key defaults to empty string
# \#   PASS: role defaults to empty string
# \#   PASS: by_ai defaults to true
# \#   PASS: date format is YYYY-MM-DD
# \#   PASS: meta_key can be updated via spread
# \#   PASS: role can be updated via spread
# \#   PASS: by_ai is boolean
# \#   PASS: old state without date gets migrated
# \#   PASS: old state without meta_key gets empty string
# \#   PASS: old state without role gets empty string
# \#   PASS: old state without by_ai gets true
# \#   PASS: below threshold â†’ isLong: false
# \#   PASS: at threshold â†’ isLong: true
# \#   PASS: above threshold â†’ correct suggestion
# \#   PASS: threshold of 0 â†’ immediately long
# \#   PASS: suggestion includes turn count
# \#   PASS: suggestion includes threshold
# \# === Session Structure: 18 passed, 0 failed ===
# Subtest: === Session Structure Tests ===
    # Subtest: --- session creation ---
        # Subtest: date is set to today's YYYY-MM-DD
        ok 1 - date is set to today's YYYY-MM-DD
          ---
          duration_ms: 2.573022
          type: 'test'
          ...
        # Subtest: meta_key defaults to empty string
        ok 2 - meta_key defaults to empty string
          ---
          duration_ms: 0.604116
          type: 'test'
          ...
        # Subtest: role defaults to empty string
        ok 3 - role defaults to empty string
          ---
          duration_ms: 0.367424
          type: 'test'
          ...
        # Subtest: by_ai defaults to true
        ok 4 - by_ai defaults to true
          ---
          duration_ms: 0.340564
          type: 'test'
          ...
        1..4
    ok 1 - --- session creation ---
      ---
      duration_ms: 5.154478
      type: 'suite'
      ...
    # Subtest: --- session metadata ---
        # Subtest: date format is YYYY-MM-DD
        ok 1 - date format is YYYY-MM-DD
          ---
          duration_ms: 0.655824
          type: 'test'
          ...
        # Subtest: meta_key can be updated via spread
        ok 2 - meta_key can be updated via spread
          ---
          duration_ms: 0.411492
          type: 'test'
          ...
        # Subtest: role can be updated via spread
        ok 3 - role can be updated via spread
          ---
          duration_ms: 0.298895
          type: 'test'
          ...
        # Subtest: by_ai is boolean
        ok 4 - by_ai is boolean
          ---
          duration_ms: 0.589526
          type: 'test'
          ...
        1..4
    ok 2 - --- session metadata ---
      ---
      duration_ms: 2.506403
      type: 'suite'
      ...
    # Subtest: --- persistence migration ---
        # Subtest: old state without date gets migrated
        ok 1 - old state without date gets migrated
          ---
          duration_ms: 0.918214
          type: 'test'
          ...
        # Subtest: old state without meta_key gets empty string
        ok 2 - old state without meta_key gets empty string
          ---
          duration_ms: 0.75037
          type: 'test'
          ...
        # Subtest: old state without role gets empty string
        ok 3 - old state without role gets empty string
          ---
          duration_ms: 0.396539
          type: 'test'
          ...
        # Subtest: old state without by_ai gets true
        ok 4 - old state without by_ai gets true
          ---
          duration_ms: 0.324665
          type: 'test'
          ...
        1..4
    ok 3 - --- persistence migration ---
      ---
      duration_ms: 2.673226
      type: 'suite'
      ...
    # Subtest: --- long session detection ---
        # Subtest: below threshold â†’ isLong: false
        ok 1 - below threshold â†’ isLong: false
          ---
          duration_ms: 2.466745
          type: 'test'
          ...
        # Subtest: at threshold â†’ isLong: true
        ok 2 - at threshold â†’ isLong: true
          ---
          duration_ms: 0.332723
          type: 'test'
          ...
        # Subtest: above threshold â†’ correct suggestion
        ok 3 - above threshold â†’ correct suggestion
          ---
          duration_ms: 0.334319
          type: 'test'
          ...
        # Subtest: threshold of 0 â†’ immediately long
        ok 4 - threshold of 0 â†’ immediately long
          ---
          duration_ms: 0.237114
          type: 'test'
          ...
        # Subtest: suggestion includes turn count
        ok 5 - suggestion includes turn count
          ---
          duration_ms: 0.244162
          type: 'test'
          ...
        # Subtest: suggestion includes threshold
        ok 6 - suggestion includes threshold
          ---
          duration_ms: 0.230146
          type: 'test'
          ...
        1..6
    ok 4 - --- long session detection ---
      ---
      duration_ms: 4.361864
      type: 'suite'
      ...
    # Subtest: summary
    ok 5 - summary
      ---
      duration_ms: 0.199259
      type: 'test'
      ...
    1..5
ok 28 - === Session Structure Tests ===
  ---
  duration_ms: 15.942659
  type: 'suite'
  ...
# === Soft Governance Tests ===
# --- soft-governance: increments turn count ---
#   PASS: state exists after hook calls
#   PASS: turn count incremented to 3
# --- soft-governance: tracks tool health ---
#   PASS: total tool calls is 2
#   PASS: successful tool calls is 2
#   PASS: health score is 100%
# --- soft-governance: drift warning on high turns ---
#   PASS: drift warning logged when turns >= 5 and drift < 50
# --- soft-governance: no drift warning when healthy ---
#   PASS: no drift warning when turns low and drift high
# --- soft-governance: strict violation on LOCKED write ---
#   PASS: violation count incremented for write in LOCKED
#   PASS: violation warning logged
# --- soft-governance: no violation on LOCKED read ---
#   PASS: no violation for read in LOCKED strict
# --- soft-governance: no violation when OPEN ---
#   PASS: no violation for write in OPEN strict
# --- soft-governance: assisted mode never tracks violations ---
#   PASS: assisted mode does not track violations
# --- soft-governance: chain break warning logged ---
#   PASS: chain break warning logged when action has no parent tactic
# --- soft-governance: no chain break when hierarchy intact ---
#   PASS: no chain break warning when hierarchy is complete
# --- soft-governance: commit suggestion turn tracked ---
#   PASS: last_commit_suggestion_turn updated when threshold met
# --- soft-governance: long session warning ---
#   PASS: long session warning suggests compact_session at threshold
# --- soft-governance: no long session warning below threshold ---
#   PASS: no long session warning when below threshold
# --- soft-governance: does not crash without brain state ---
#   PASS: warns about missing brain state
#   PASS: hook did not crash without brain state
# --- soft-governance: skips when no sessionID ---
#   PASS: hook skips gracefully when sessionID is empty
# --- soft-governance: last_activity timestamp updated ---
#   PASS: last_activity timestamp updated
# --- soft-governance: multiple violations accumulate ---
#   PASS: 3 violations accumulated for 3 write/edit calls in LOCKED
# --- soft-governance: debug logging output ---
#   PASS: debug log includes tool name
#   PASS: debug log includes turn count
# --- soft-governance: permissive mode still tracks ---
#   PASS: permissive mode still increments turns
#   PASS: permissive mode still tracks tool calls
#   PASS: permissive mode does not track violations
# --- soft-governance: out-of-order toast severity progression ---
#   PASS: first out-of-order toast is info
#   PASS: second out-of-order toast is warning
#   PASS: repeated out-of-order toast escalates to error
# --- soft-governance: evidence-pressure escalation ---
#   PASS: first evidence-pressure toast is warning
#   PASS: repeated evidence-pressure toast escalates to error
# --- soft-governance: ignored triage toast format ---
#   PASS: ignored toast includes triage reason/action/fix format
#   PASS: ignored toast variant is error
#   PASS: ignored escalation logs compact tri-evidence block
# --- soft-governance: ignored downgrade after acknowledgement ---
#   PASS: acknowledgement downgrades ignored counter when prerequisites incomplete
#   PASS: acknowledgement consumed after downgrade
# --- soft-governance: ignored full reset when prerequisites complete ---
#   PASS: ignored counter fully resets after prerequisites complete
#   PASS: prerequisites flag remains true after reset
# === Soft Governance: 39 passed, 0 failed ===
# Subtest: tests/soft-governance.test.ts
ok 29 - tests/soft-governance.test.ts
  ---
  duration_ms: 851.656611
  type: 'test'
  ...
# === Sync Assets Tests ===
# --- sync-assets: project target (default) ---
#   PASS: one target synced by default
#   PASS: commands synced to project .opencode
#   PASS: skills synced to project .opencode
# --- sync-assets: idempotent no-clobber default ---
#   PASS: existing file preserved when overwrite=false
# --- sync-assets: overwrite existing files ---
#   PASS: existing file replaced when overwrite=true
# --- sync-assets: global target ---
#   PASS: global-only sync has one target
#   PASS: commands synced to global target
#   PASS: skills synced to global target
#   PASS: project .opencode not written for global-only target
# --- sync-assets: both targets ---
#   PASS: both target sync writes two targets
#   PASS: project target written
#   PASS: global target written
# --- sync-assets: init + re-init integration ---
#   PASS: init syncs opencode assets
#   PASS: fixture removed command file
#   PASS: re-init restores missing opencode asset
# --- sync-assets: validation skips invalid assets ---
#   PASS: valid command copied
#   PASS: invalid command skipped
#   PASS: valid skill copied
#   PASS: invalid skill skipped
#   PASS: invalid assets counted in report
# --- sync-assets: optional ecosystem groups sync when present ---
#   PASS: agents synced
#   PASS: workflows synced
#   PASS: templates synced
#   PASS: prompts synced
#   PASS: references synced
# --- sync-assets: validation skips invalid agent/workflow schema ---
#   PASS: invalid agent skipped
#   PASS: invalid workflow skipped
#   PASS: invalid schema counted
# --- sync-assets: packaged optional groups sync by default ---
#   PASS: packaged agent asset synced
#   PASS: packaged workflow asset synced
#   PASS: packaged template asset synced
#   PASS: packaged prompt asset synced
#   PASS: packaged reference asset synced
# === Sync Assets: 33 passed, 0 failed ===
# Subtest: tests/sync-assets.test.ts
ok 30 - tests/sync-assets.test.ts
  ---
  duration_ms: 669.31394
  type: 'test'
  ...
# === Tool Gate Tests ===
# --- tool-gate: strict blocks write without session ---
#   PASS: strict mode allows write without session (HC1: advisory only)
#   PASS: strict mode provides advisory warning
# --- tool-gate: strict allows exempt tools ---
#   PASS: read tool is exempt
#   PASS: bash tool is exempt
#   PASS: declare_intent is exempt
# --- tool-gate: strict allows write when session unlocked ---
#   PASS: write allowed when session is OPEN
# --- tool-gate: assisted warns but allows ---
#   PASS: assisted mode allows write
#   PASS: assisted mode provides warning
# --- tool-gate: permissive allows silently ---
#   PASS: permissive mode allows
#   PASS: permissive mode no warning
# --- tool-gate: drift tracking ---
#   PASS: state exists after tool calls
#   PASS: file touches tracked for write tools
# === Tool Gate: 12 passed, 0 failed ===
# Subtest: tests/tool-gate.test.ts
ok 31 - tests/tool-gate.test.ts
  ---
  duration_ms: 510.16861
  type: 'test'
  ...
1..31
# tests 57
# suites 5
# pass 57
# fail 0
# cancelled 0
# skipped 0
# todo 0
# duration_ms 6678.465363
